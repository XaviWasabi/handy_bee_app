<%# RATINGS = [1, 2, 3, 4, 5] %>


<h2>All businesses available here</h2>

<div class="container-index-page">
<!-- Filter by category -->
<div class="title-index">
   <p> <strong> <%= params[:query].split.first.capitalize %> </strong> </p>
   <p>Business available <strong><%= @businesses_count %></strong> </p>
</div>

<div class="searchbar">
  <div class="row d-flex justify-content-around" style="margin-top: 40px">
    <div class="right-inner-addon">
      <i class="icon-search"></i>
      <input type="search" class="form-control" placeholder="Search" style="width: 400px"/>

  <div class="title-index">
   <!-- home-dropdown-banner -->
    <div class="row d-flex justify-content-around" style="margin-top: 40px">
      <h2><strong> <%= params[:query].split.first.capitalize if params[:query].present? %></strong>: <%= pluralize @businesses.length, "service" %> available for you</h2>
    </div>
  </div>
</div>

  <%= form_tag(businesses_path, method: "get", id: "filters") do %>
    <%= select_tag :language,  options_for_select(@languages, params[:language]), class: "dropdown input-group dropdown-filter", include_blank: "Language" %>
    <%= select_tag :rating,  options_for_select([1, 2, 3, 4, 5], params[:rating]), class: "dropdown input-group dropdown-filter", include_blank: "Rating" %>
    <%#= select_tag :filter,  options_for_select(@languages_uniq, params[:filter]), class: "dropdown input-group dropdown-filter", include_blank: "Language" %>

<!-- dropdown index page -->
  <div class="dropdown-index-page">
    <%= form_tag(businesses_path, method: "get") do %>
      <%= select_tag :query,  options_for_select([["English"], ["German"]], params[:query]), class: "language", id: "dropdown-filter", include_blank: "Language" %>
      <%= select_tag :query,  options_for_select([["5"], ["4"], ["3"], ["2"], ["1"],], params[:query]), class: "rating", id: "dropdown-filter", include_blank: "Rating" %>
      <%= select_tag :query,  options_for_select([["50$"], ["100$"], ["200$"], ["300$"]], params[:query]), class: "price", id: "dropdown-filter", include_blank: "Price" %>
    <% end %>
  </div>
    <%= hidden_field_tag :query, params[:query] %>

    <input type="submit" class="button-main" value="Search" for="dropdown-index"/>
  <% end %>

  <%#= link_to "Sort by rating", sort: "rating"  %>

<div class="container">








  <!-- Card grid container with all the cards-->

  <div class="cards-container-index-page">
    <% @businesses.each do |business| %>
    <!-- each card -->
    <div class="frame " style="margin-bottom: 20px">
      <div class="center">
        <div class="profile">
          <div class="image">
            <div class="circle-1"></div>
              <div class="circle-2"></div>
               <% if business.user.picture.attached? %>
                <%= cl_image_tag b.business.user.picture.key, class: "avatar-index" %>
              <% else %>
                <%= cl_image_tag("https://res.cloudinary.com/jordannadroj/image/upload/v1613501376/pkvrmhcsxi7i7slo0tcx.jpg", alt: "alttext", class: "avatar-index") %>
              <% end %>
              </div>

              <div class="name"><%= business.name %></div>
              <div class="job"><%= business.description %></div>

              <!-- button -->
              <div class="actions">
                <%= link_to "View", business_path(business), class: "btn" %>
              </div>
        </div>

        <!-- cards with icons -->
        <div class="stats">
          <div class="box">
            <i class="fas fa-bolt"></i>
            <span class="parameter"><%= business.category %></span>
          </div>
          <div class="box">
            <i class="fas fa-map-marker-alt"></i>
              <span class="value"><%= business.location %></span>
          </div>
          <div class="box">
            <i class="fas fa-language"></i>
            <span class="parameter">
              <% unique_languages = business.languages.uniq %>
              <% unique_languages.each do |language| %>
                <%= language.name %>
              <% end %>
            </span>
          </div>
        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>

